[gd_scene load_steps=14 format=2]

[ext_resource path="res://scenes/2d/room_loader_2d.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/2d/rooms/house of culture/piano_room.tscn" type="PackedScene" id=2]
[ext_resource path="res://scenes/2d/main_camera_2d.tscn" type="PackedScene" id=3]
[ext_resource path="res://scenes/2d/character & player/player_start_2d.tscn" type="PackedScene" id=4]
[ext_resource path="res://scripts/Room2D/Map2D.gd" type="Script" id=5]
[ext_resource path="res://scenes/3d/minigame tutorial scenes/forward_hallway_long.tscn" type="PackedScene" id=6]
[ext_resource path="res://scenes/x to focus/focus_scene.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/2d/minigame/piano/piano.tscn" type="PackedScene" id=8]
[ext_resource path="res://scenes/2d/rooms/house of culture/house_of_culture_hall.tscn" type="PackedScene" id=9]
[ext_resource path="res://scenes/2d/interactable/interactable_room_changer_2d.tscn" type="PackedScene" id=10]
[ext_resource path="res://scenes/2d/misc/birds.ogg" type="AudioStream" id=17]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float speed : hint_range(0.1, 16.0) = 2.0;
uniform float strength : hint_range(0.0, 0.5) = 0.1;
uniform vec2 position;
uniform vec2 size = vec2(48.0, 64.0);
uniform float distance_threshold : hint_range(0.0, 1.0) = 0.1;
uniform float uv_split = 32.0;

float random(vec2 st)
{
	return fract(sin(dot(mod(st, 10.0), vec2(53.4582, 17.3845))) * 45348.2847);
}

void fragment()
{
	float t = TIME * speed;
	float ftime = fract(t);
	float itime = floor(t);
	
	vec2 ruv = vec2(floor(UV.y * uv_split) / uv_split, 0.0);
	float r = mix(random(ruv + itime), random(ruv + itime + 1.0), ftime);
	r = (r * 2.0 - 1.0) * strength;
	
	vec2 uv = UV;
	float dist = max(0.0, distance(position / size, UV) - distance_threshold);
	uv.x += r * dist;
	
	COLOR = texture(TEXTURE, uv);
}"

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 1 )
shader_param/speed = 16.0
shader_param/strength = 0.005
shader_param/position = Vector2( 480, 580 )
shader_param/size = Vector2( 960, 720 )
shader_param/distance_threshold = 0.0
shader_param/uv_split = 512.0

[node name="piano_room_map" type="Node2D"]
script = ExtResource( 5 )

[node name="piano" parent="." instance=ExtResource( 1 )]
room_name = "piano"
room = ExtResource( 2 )
preview = true
size = Vector2( 144, 168 )

[node name="hall" parent="." instance=ExtResource( 1 )]
room_name = "hall"
room = ExtResource( 9 )
size = Vector2( 360, 192 )

[node name="camera" parent="." instance=ExtResource( 3 )]
position = Vector2( -24, 12 )
target_group = "player_2d"
target_is_character = true

[node name="player_start" parent="." instance=ExtResource( 4 )]
position = Vector2( 252, 108 )
room_name = "hall"

[node name="focus_scene_imagined_corridor" parent="." instance=ExtResource( 7 )]
scene = ExtResource( 6 )
pass_player_position = true
is_2d = false
material = SubResource( 4 )
offset = Vector2( -320, 0 )
layer = -1

[node name="hall_to_piano" parent="." instance=ExtResource( 10 )]
position = Vector2( 108, 132 )
room_name = "piano"

[node name="hall_to_piano2" parent="." instance=ExtResource( 10 )]
position = Vector2( 108, 156 )
room_name = "hall"

[node name="controller" parent="." instance=ExtResource( 8 )]
modulate = Color( 1, 1, 1, 0 )
position = Vector2( -160, -80 )
z_index = 1

[node name="music" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 17 )
autoplay = true
